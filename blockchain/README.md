# Blockchain Project

This project is a blockchain application built using Hardhat.

## Table of Contents
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Configuration](#configuration)
- [Smart Contracts](#smart-contracts)
- [Scripts](#scripts)
- [Deployment](#deployment)

## Prerequisites

Before you begin, ensure you have met the following requirements:
* You have installed Node.js and npm

## Installation

To install this project, follow these steps:

1. Navigate to the project directory:
   ```
   cd blockchain
   ```
3. Install the dependencies:
   ```
   npm install
   ```

## Configuration

The project uses Hardhat as the development environment. You may need to adjust the `hardhat.config.js` file to suit your needs.

1. Open `hardhat.config.js`
2. Modify the network settings, compiler version, and other configurations as needed
3. Create a `.env` file in the project directory and add your variables

`.env`:

```markdown
# Replace with addresses as soon as deployed
DEVICEREGISTRY_ADDRESS="[Device Registry Address]"
ALLOWANCECONTRACT_ADDRESS="[Allowance Contract Address]"
CARBTOKEN_ADDRESS="[CarbToken Address]"
DIST_VERIFIER_CONTRACT_ADDRESS="[Verifier Contract Address]"
CRBCERT_ADDRESS="[CarbCertificate Address]"

# Replace with your own keys or generate ones for using it as company keys
PRIV_KEY_TESTNET="[Your Private Key]"
ADDRESS_TESTNET="[Your Address]"
COMPANY_KEY_TESTNET="[Your Company Key]"
COMPANY_ADDRESS_TESTNET="[Your Company Address]"
COMPANY_ALLOWANCE=[Company Allowance]
COMPANY_DEVICE_ID=[Company Device ID]

# Replace with your own vehicles
VEHICLE_ID=[Your Company Allowance]
VEHICLE_TYPE="[Vehicle Type]"
AVG_EMISSIONS=[Vehicle Emissions]
```

## Smart Contracts

This project includes several smart contracts. Here's a brief overview of each:

1. `DeviceRegistry.sol`: Registry of devices and vehicles
2. `Verifier.sol`: zk-Verifier generated by ZoKrates 
3. `AllowanceContract.sol`: On-chain business logic of carbon allowance use case
4. `CarbToken.sol`: ERC20 token CarbToken
5. `CarbCertificate.sol`: ERC721 token CarbCertificate

To compile the smart contracts, run:
```
npx hardhat compile
```

## Deployment

To deploy the smart contracts (Initial Setup) on the testnet:

1. Run the deployment script:
   ```
   npx hardhat ignition deploy ./ignition/modules/FirstPart.js --network testnet
   ```
2. Add all available .env variables
3. Run deployment script to deploy the Verifier (address of AllowanceContract is set during deployment):
   ```
   npx hardhat ignition deploy ./ignition/modules/Verifier.js --network testnet
   ```
4. Add Verifier address in .env file
5. Run the AccessManagement script:
    ```
    npx hardhat run scripts/1_AccessManagement.js
    ```
6. Run the OperationalSetups script:
    ```
    npx hardhat run scripts/2_OperationalSetups.js
    ```
(add or adjust company/device/vehicle data as needed, default is one company, one device, one vehicle as in .env template)
7. Initial setup is complete, Verifier ready to receive proofs

## Scripts

There are multiple scripts to interact with the smart contracts:

1. `scripts/1_AccessManagement.js`: Set access roles and addresses within the contracts for initial setup
2. `scripts/2_OperationalSetups.js`: Operational setups for initial setup 
3. `scripts/3a_OperationalFunctions.js`: Additional operational functions (ioCarb)
4. `scripts/3b_OperationalFunctions.js`: Additional operational functions (company)
5. `scripts/4_TokenTrading.js`: Send IOTX and CRB
6. `scripts/5_AdditionalGetterFunctions.js`: Getter functions for different data
7. `scripts/utils/`: Additional functions used during testing

To run a script:
```
npx hardhat run scripts/[script-name].js
```